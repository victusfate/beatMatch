<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>

.chart div {
  font: 10px sans-serif;
  background-color: teal;
  text-align: right;
  padding: 3px;
  margin: 1px;
  color: white;
}

</style>
<div class="chart"></div>
<script src="http://d3js.org/d3.v3.min.js"></script>

<script type='text/javascript'>


window.onload = function() {
    var allData = RESULTS.results;
    var data = allData[0];

    var timer = new Date();

    var canvas = document.getElementById('songcanvas');
    var ctx = canvas.getContext("2d");
    var gradient = ctx.createLinearGradient(0,0,0,canvas.height);
    gradient.addColorStop(1,'#000000');
    gradient.addColorStop(0.75,'#ff0000');
    gradient.addColorStop(0.25,'#ffff00');
    gradient.addColorStop(0,'#ffff00');

    ctx.fillStyle = gradient;


    function drawSpectrum() {
        var WIDTH = canvas.width,
            HEIGHT= canvas.height;
        audioAnimation = requestAnimationFrame(drawSpectrum);
        var sampleRate = 0.023220;
        var iData = parseInt((Date.now() - timer)/sampleRate,10);
        if (iData >= 0 && iData < allData.length) {
            console.log('iData',iData);
            ctx.clearRect(0, 0, WIDTH, HEIGHT);
            data = allData[iData];
            for ( var i = 0; i < (data.length); i++ ){
                var value = data[i];
                ctx.fillRect(i*5,HEIGHT-value,3,HEIGHT);
            }
        }
    }
    drawSpectrum();
/*
    simple array
    var width = window.innerWidth - 50;
    var height = window.innerHeight - 50;
    var w = width/data.length,
        h = height;

    var iSet=0;
    setInterval(function() {
        data = allData[iSet]
        if (iSet < allData.length) iSet++;
        else {
            iSet = 0;
        }

        /*
        var oldChart = d3.select(".chart").select("svg");
        oldChart.remove();

        var chart = d3.select(".chart").append("svg")
            .attr("class", "chart")
            .attr("width", w * data.length)
            .attr("height", h);
        
        var x = d3.scale.linear()
            .domain([0, 1])
            .range([0, w]);   
        
        var y = d3.scale.linear()
            .domain([0, d3.max(data)])
            .rangeRound([0, h]); //rangeRound is used for antialiasing// x and y are the lower-left position of the bar


        data = allData[iSet]
        if (iSet < allData.length) iSet++;
        else {
            iSet = 0;
        }
        console.log(data);

        // width is the width of the bar
        // height is the height of the bar
        // for crisp edges use -.5 (antialiasing)
        chart.selectAll("rect")
            .data(data)
        .enter().append("rect")
            .transition()
            .attr("x", function(d, i) { return x(i) - .5; })
            .attr("y", function(d) { return h - y(d) - .5; })
            .attr("width", w)
            .attr("height", function(d) { return y(d); } );

        // horizontal line for the x-axis
        chart.append("line")
           .attr("x1", 0)
           .attr("x2", w * data.length)
           .attr("y1", h - .5)
           .attr("y2", h - .5)
           .style("stroke", "#000");
    }, 100);
*/

}

</script>
</head>
<body>
  <canvas id="songcanvas" width="1000" height="325"></canvas>
</body>

<script type='text/javascript' src="spectrum.json"></script>
</html>